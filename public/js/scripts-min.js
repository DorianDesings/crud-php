"use strict";var main=document.getElementById("main"),allUsers=document.getElementById("all-users"),userInfo=document.getElementById("user-info"),allNames=[],allUsersData=[],contentUsers=document.getElementById("content-users"),allUserCheck=document.getElementById("select-all-users"),deleteAllButton=document.getElementById("delete-all-users"),allUsersButtons=Array.from(document.querySelectorAll(".content__users .button")),allUserChecks=Array.from(document.querySelectorAll(".content__users .content__checkbox")),topBarTitle=document.getElementById("top-bar-title"),addUserButton=document.getElementById("add-user"),updateUserButton=document.getElementById("update-user"),searchText=document.getElementById("search-text"),newUser=!0,userName=document.getElementById("user-info-name"),userSurname=document.getElementById("user-info-surname"),userEmail=document.getElementById("user-info-email"),showUserInfo=function(){allUsers.classList.add("all-users--hide"),userInfo.classList.add("user-info--show")},hideUserInfo=function(){allUsers.classList.remove("all-users--hide"),userInfo.classList.remove("user-info--show")},selectUser=function(e){var t=document.getElementById(e);allUsersButtons=Array.from(document.querySelectorAll(".content__users .button")),allUserChecks=Array.from(document.querySelectorAll(".content__users .content__checkbox")),t.checked?(allUserChecks.map(function(e){return e.checked=!1}),t.checked=!0,allUsersButtons.map(function(e){return e.classList.add("button--hide")}),Array.from(t.parentElement.querySelectorAll(".button")).map(function(e){return e.classList.remove("button--hide")})):allUsersButtons.map(function(e){return e.classList.remove("button--hide")})},selectAllUsers=function(){allUsersButtons=Array.from(document.querySelectorAll(".content__users .button")),allUserChecks=Array.from(document.querySelectorAll(".content__users .content__checkbox")),allUserCheck.checked?(allUserChecks.map(function(e){return e.checked=!0}),allUsersButtons.map(function(e){return e.classList.add("button--hide")}),deleteAllButton.classList.remove("button--hide")):(allUserChecks.map(function(e){return e.checked=!1}),allUsersButtons.map(function(e){return e.classList.remove("button--hide")}),deleteAllButton.classList.add("button--hide"))},addUser=function(){topBarTitle.textContent="New User",addUserButton.classList.remove("button--hide"),updateUserButton.classList.add("button--hide")},saveUser=function(e){topBarTitle.textContent="Edit User",addUserButton.classList.add("button--hide"),updateUserButton.classList.remove("button--hide");var t=getUserId(e);userName.value=t.name,userSurname.value=t.surname,userEmail.value=t.email,updateUserButton.dataset.id=t.id},getUserId=function(t){return t=t.substring(t.lastIndexOf("-")+1),allUsersData.filter(function(e){return e.id==t})[0]},getAllUsers=function(){fetch("php/read-all.php").then(function(e){return e.ok?Promise.resolve(e):Promise.reject(new Error("Failed to load"))}).then(function(e){return console.log(e.json())}).then(function(e){allUsersData=e;var t=document.createDocumentFragment(),n=!0,r=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var l=a.value;t.appendChild(createUserRow(l))}}catch(e){r=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw s}}contentUsers.innerHTML="",contentUsers.appendChild(t),allNames=Array.from(document.querySelectorAll("[data-name]")),console.log(allNames)}).catch(function(e){return console.log("Error: ".concat(e.message))})},createUserRow=function(e){var t=document.createDocumentFragment(),n=document.createElement("DIV");n.classList.add("content__user");var r=document.createElement("INPUT");r.setAttribute("type","checkbox"),n.appendChild(r);var s=document.createElement("P");s.dataset.name=e.name,s.classList.add("content__text"),s.textContent=e.name,n.appendChild(s);var a=document.createElement("P");a.classList.add("content__text"),a.textContent=e.surname,n.appendChild(a);var o=document.createElement("P");o.classList.add("content__text","content__text--email"),o.textContent=e.email,n.appendChild(o);var l=document.createElement("A");l.classList.add("content__link","button","button--edit"),l.textContent="Edit",l.id="edit-user-".concat(e.id);var u=document.createElement("I");u.classList.add("fas","fa-pen"),l.appendChild(u),n.appendChild(l);var c=document.createElement("A");return c.classList.add("content__link","button","button--delete"),c.textContent="Delete",c.id="delete-user-".concat(e.id),(u=document.createElement("I")).classList.add("fas","fa-trash"),c.appendChild(u),n.appendChild(c),t.appendChild(n),t},insertUser=function(){var e=new FormData;e.append("name",userName.value.toLowerCase()),e.append("surname",userSurname.value.toLowerCase()),e.append("email",userEmail.value.toLowerCase()),fetch("php/insert.php",{method:"POST",body:e}).then(function(e){return e.ok?Promise.resolve(e):Promise.reject(new Error("Failed to load"))}).then(function(e){return e.text()}).then(function(e){"ok"===e&&(resetForm(),getAllUsers(),hideUserInfo())}).catch(function(e){return console.log("Error: ".concat(e.message))})},updateUser=function(){var e=new FormData;e.append("id",updateUserButton.dataset.id),e.append("name",userName.value.toLowerCase()),e.append("surname",userSurname.value.toLowerCase()),e.append("email",userEmail.value.toLowerCase()),fetch("php/update.php",{method:"POST",body:e}).then(function(e){return e.ok?Promise.resolve(e):Promise.reject(new Error("Failed to load"))}).then(function(e){return e.text()}).then(function(e){"ok"===e&&(resetForm(),getAllUsers(),hideUserInfo())}).catch(function(e){return console.log("Error: ".concat(e.message))})},deleteUser=function(e){e=getUserId(e).id;var t=new FormData;t.append("id",e),fetch("php/delete.php",{method:"POST",body:t}).then(function(e){return e.ok?Promise.resolve(e):Promise.reject(new Error("Failed to load"))}).then(function(e){return e.text()}).then(function(e){"ok"===e&&(location.href="http://localhost:3000/crud/public/")}).catch(function(e){return console.log("Error: ".concat(e.message))})},resetForm=function(){userName.value="",userSurname.value="",userEmail.value=""};main.addEventListener("click",function(e){e.target.classList.contains("top-bar__user-info")||e.target.classList.contains("fa-plus")?(newUser=!0,addUser(),showUserInfo()):e.target.classList.contains("button--cancel")?hideUserInfo():e.target.classList.contains("content__checkbox")?selectUser(e.target.id):"select-all-users"===e.target.id?selectAllUsers():-1!==e.target.id.indexOf("edit-user")?(newUser=!1,saveUser(e.target.id),showUserInfo()):"add-user"==e.target.id?insertUser():"update-user"==e.target.id?updateUser():-1!=e.target.id.indexOf("delete-user")&&deleteUser(e.target.id)}),searchText.addEventListener("keyup",function(e){var t=searchText.value.toLowerCase();if(""==t){var n=!0,r=!1,s=void 0;try{for(var a,o=allNames[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){a.value.parentElement.style.display="grid"}}catch(e){r=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw s}}}var l=!0,u=!1,c=void 0;try{for(var d,i=allNames[Symbol.iterator]();!(l=(d=i.next()).done);l=!0){var m=d.value;-1==m.dataset.name.indexOf(t)?m.parentElement.style.display="none":m.parentElement.style.display="grid"}}catch(e){u=!0,c=e}finally{try{l||null==i.return||i.return()}finally{if(u)throw c}}}),getAllUsers();